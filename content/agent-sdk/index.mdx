# isA Agent SDK

Build intelligent AI agents with advanced features including streaming, tools, human-in-the-loop, and durable execution.

## Installation

```bash
pip install isa-agent-sdk
```

## Quick Start

```python
from isa_agent_sdk import query

async for msg in query("Hello, world!"):
    print(msg.content, end="" if msg.is_text else "\n")
```

## Latest Updates (2026-02-14)

- **Audit hardening completed** - all tracked security audit findings (issues `#13` to `#26`) were resolved in `isa_agent_sdk`.
- **Swarm + DAG workflows expanded** - production-ready dynamic handoffs (`[HANDOFF:...]`) and dependency-ordered DAG execution are now documented and tested.
- **A2A support stabilized** - Agent Card + JSON-RPC adapters are now part of the standard integration path.
- **Test coverage increased** - SDK test suite is at **234 passing tests**, including dedicated audit regression coverage.

## Core Concepts

### Streaming vs Single Mode

The SDK supports both streaming and single-turn interactions:

```python
# Streaming - get messages as they arrive
async for msg in query("Explain AI"):
    if msg.is_text:
        print(msg.content, end="")
    elif msg.is_tool_use:
        print(f"[Using: {msg.tool_name}]")

# Single mode - get complete response
from isa_agent_sdk import ask

result = await ask("What is 2+2?")
print(result.content)
```

[Learn more about streaming](./streaming)

### Configuration Options

Control agent behavior with `ISAAgentOptions`:

```python
from isa_agent_sdk import query, ISAAgentOptions

options = ISAAgentOptions(
    model="gpt-4.1-nano",
    allowed_tools=["web_search", "read_file"],
    max_iterations=30,
    skills=["code-review", "debug"]
)

async for msg in query("Review this code", options=options):
    print(msg.content, end="" if msg.is_text else "\n")
```

[Full options reference](./options)

### Tools & MCP Integration

Access a wide range of tools via the Model Context Protocol:

```python
from isa_agent_sdk import execute_tool, get_available_tools

# Discover tools
tools = await get_available_tools(user_query="search the web")

# Execute directly
result = await execute_tool("web_search", {"query": "Python tutorials"})
```

[Tools documentation](./tools)

### Human-in-the-Loop

Enable agents to pause and request human approval:

```python
from isa_agent_sdk import request_tool_permission

authorized = await request_tool_permission(
    tool_name="delete_file",
    tool_args={"path": "/data/file.txt"},
    reason="Cleaning up old data"
)

if authorized:
    # proceed
```

[HIL documentation](./human-in-the-loop)

### Skills System

Activate specialized behaviors via prompt injection:

```python
options = ISAAgentOptions(
    skills=["code-review", "debug", "refactor"]
)
```

Built-in skills:
- `code-review` - Expert code reviewer
- `debug` - Systematic debugger
- `refactor` - Refactoring specialist
- `test-writer` - Test coverage expert
- `documentation` - Technical writer

[Skills documentation](./skills)

### Event Triggers

Enable proactive agent activation:

```python
from isa_agent_sdk import register_trigger, TriggerType

trigger_id = await register_trigger(
    user_id="user-123",
    trigger_type=TriggerType.THRESHOLD,
    description="Alert on price drop",
    conditions={"threshold_value": 5.0, "direction": "down"},
    action_config={"prompt": "Analyze the drop"}
)
```

[Triggers documentation](./triggers)

### A2A (Agent-to-Agent)

Run interoperable agent-to-agent communication using Agent Card discovery and JSON-RPC endpoints.

[A2A guide](./a2a)

### Steward (Personal)

The agent acts as a personal steward, managing tasks, calendar, and proactive automation:

```python
# Via agent conversation
"Create a todo task called 'Review PR' with high priority"
"What's on my calendar tomorrow?"
"Alert me when Bitcoin drops 5%"

# Programmatic access
options = ISAAgentOptions(
    user_id="user-123",
    allowed_tools=[
        "create_task", "list_tasks", "complete_task",
        "create_calendar_event", "get_upcoming_events",
        "register_price_alert", "list_triggers"
    ]
)
```

Steward capabilities:
- **Task Management** (9 tools) - TODO, reminders, tracking
- **Calendar** (9 tools) - Events, scheduling, sync
- **Event Triggers** (6 tools) - Alerts, automation

[Steward documentation](./steward)

### Structured Outputs

Get validated JSON matching your schema:

```python
from pydantic import BaseModel
from isa_agent_sdk import query, ISAAgentOptions, OutputFormat

class Recipe(BaseModel):
    name: str
    ingredients: list[str]
    prep_time_minutes: int

async for msg in query(
    "Find a chocolate chip cookie recipe",
    options=ISAAgentOptions(
        output_format=OutputFormat.from_pydantic(Recipe)
    )
):
    if msg.has_structured_output:
        recipe = msg.parse(Recipe)
        print(f"Recipe: {recipe.name}")
```

[Structured outputs documentation](./structured-outputs)

### Desktop Execution

Route tool execution to a user's local desktop via Pool Manager:

```python
from isa_agent_sdk import query, ISAAgentOptions, ExecutionEnv

options = ISAAgentOptions(
    env=ExecutionEnv.DESKTOP,
    user_id="xenodennis",
    allowed_tools=["read_file", "write_file", "bash_execute", "glob_files"]
)

async for msg in query("Find all Python files and search for 'API'", options=options):
    if msg.is_tool_use:
        print(f"[Executing on desktop: {msg.tool_name}]")
    elif msg.is_text:
        print(msg.content, end="")
```

The LLM intelligently decides which tools to use, and all tool calls are routed through:
```
SDK → Pool Manager → Desktop Agent → Local Filesystem
```

[Desktop execution documentation](./desktop-execution)

### Durable Execution

Checkpoint and resume long-running tasks:

```python
from isa_agent_sdk import query, resume, ExecutionMode

options = ISAAgentOptions(
    execution_mode=ExecutionMode.COLLABORATIVE,
    session_id="my-task-123"
)

# Later, resume from checkpoint
async for msg in resume("my-task-123"):
    print(msg.content)
```

[Checkpointing documentation](./checkpointing)

### Deploy to isA Cloud

Deploy your custom agents to production:

```bash
# 1. Create deployment
curl -X POST http://localhost:8095/api/v1/deployments \
  -H "X-User-ID: user123" \
  -d '{"app_name": "my-agent"}'

# 2. Upload code (auto-builds)
tar -czf my-agent.tar.gz -C my-agent .
curl -X POST http://localhost:8095/api/v1/deployments/{id}/upload \
  -F "file=@my-agent.tar.gz"

# 3. Deploy version
curl -X POST http://localhost:8095/api/v1/deployments/{id}/deploy \
  -d '{"version": "v1.0.0", "replicas": 2}'

# 4. Query your deployed agent
curl -X POST http://localhost:8095/api/v1/apps/{id}/query \
  -d '{"prompt": "Hello from the cloud!"}'
```

[Deployment Guide](./deployment-guide)

## Documentation

### Getting Started
- [Quick Start](./quickstart) - First steps with the SDK
- [Agent Client](./agent-client) - Bidirectional client & error handling
- [Streaming](./streaming) - Streaming vs single mode

### Configuration
- [Options](./options) - Full configuration reference
- [Skills](./skills) - Skill system guide

### Features
- [Tools](./tools) - Tools & MCP integration
- [Steward](./steward) - Task, Calendar & Event tools (Personal 管家)
- [Human-in-the-Loop](./human-in-the-loop) - Approval workflows
- [Structured Outputs](./structured-outputs) - JSON schema & Pydantic integration
- [Triggers](./triggers) - Event-based activation
- [Checkpointing](./checkpointing) - Durable execution
- [Messages](./messages) - Message types reference

### Deployment
- [Deployment Guide](./deployment-guide) - Deploy agents to isA Cloud

### Testing
- [Testing & Verification](./testing) - Verified E2E test results

## API Reference

### Core Functions

| Function | Description |
|----------|-------------|
| `query(prompt, options)` | Stream agent responses |
| `ask(prompt, options)` | Get single response |
| `resume(session_id)` | Resume from checkpoint |
| `execute_tool(name, args)` | Execute tool directly |
| `get_available_tools()` | List available tools |

### Message Types

| Type | Description |
|------|-------------|
| `text` | Text content |
| `thinking` | Chain-of-thought |
| `tool_use` | Tool being called |
| `tool_result` | Tool result |
| `checkpoint` | Requires input |
| `error` | Error message |

### Execution Modes

| Mode | Description |
|------|-------------|
| `REACTIVE` | Standard request-response |
| `COLLABORATIVE` | Durable with checkpoints |
| `PROACTIVE` | Event-driven autonomous |

## Agent Client

The SDK provides two client interfaces:

### ISAAgentClient (Bidirectional)

For interactive multi-turn conversations (Claude SDK compatible):

```python
from isa_agent_sdk import ISAAgentClient

async with ISAAgentClient() as client:
    await client.query("Remember the number 42")
    async for msg in client.receive():
        print(msg.content)

    # Continue conversation
    await client.query("What number did I mention?")
    async for msg in client.receive():
        print(msg.content)  # Will recall 42

    # Or use convenience method
    response = await client.ask("What is 2 + 2?")
```

### ISAAgent (HTTP Client)

For deployed applications:

```python
from isa_agent_sdk import ISAAgent

client = ISAAgent(base_url="http://localhost:8000")

# Simple chat
response = client.chat.create(message="Hello!", user_id="user123")

# Streaming
for event in client.chat.stream(message="Explain AI"):
    if event.is_content:
        print(event.content, end="")
```

[Agent Client documentation](./agent-client)

## Examples

### Code Review Agent

```python
from isa_agent_sdk import query, ISAAgentOptions

options = ISAAgentOptions(
    skills=["code-review"],
    allowed_tools=["read_file"]
)

async for msg in query("Review main.py for issues", options=options):
    print(msg.content, end="" if msg.is_text else "\n")
```

### Research Agent

```python
options = ISAAgentOptions(
    allowed_tools=["web_search", "fetch_url"],
    max_iterations=50
)

async for msg in query("Research latest AI developments", options=options):
    if msg.is_tool_use:
        print(f"[Searching: {msg.tool_args}]")
    elif msg.is_text:
        print(msg.content, end="")
```

### File Processing Agent

```python
options = ISAAgentOptions(
    execution_mode=ExecutionMode.COLLABORATIVE,
    allowed_tools=["read_file", "write_file", "bash"]
)

async for msg in query("Process all CSV files in /data", options=options):
    if msg.is_checkpoint:
        await msg.respond({"continue": True})
    elif msg.is_text:
        print(msg.content, end="")
```

## Error Handling

The SDK provides typed errors for precise error handling:

```python
from isa_agent_sdk import (
    ISASDKError,        # Base error
    ConnectionError,    # Service connection failed
    ToolExecutionError, # Tool failed
    SessionError,       # Session issues
    ValidationError,    # Input validation
)

try:
    async for msg in query("Do something"):
        ...
except ToolExecutionError as e:
    print(f"Tool {e.tool_name} failed: {e.message}")
except SessionError as e:
    print(f"Session {e.session_id} error: {e}")
except ISASDKError as e:
    print(f"SDK error: {e}")
```

[Error classes reference](./agent-client#error-classes)

## Environment Variables

| Variable | Description |
|----------|-------------|
| `ISA_API_KEY` | API key for isA platform |
| `ISA_MODEL_URL` | Model service URL |
| `ISA_MCP_URL` | MCP service URL |
| `CHECKPOINTER_BACKEND` | Checkpointer backend |

## Support

- Report issues at the project repository
- Check documentation for troubleshooting guides
